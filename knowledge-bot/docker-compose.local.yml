services:
  qdrant:
    image: qdrant/qdrant:latest
    ports: [ "6333:6333" ]
    volumes: [ "qdrant_data:/qdrant/storage" ]

  ollama:
    image: ollama/ollama:latest
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
    environment:
      - OLLAMA_KEEP_ALIVE=1h
    volumes: [ "ollama:/root/.ollama" ]
    ports: [ "11435:11434" ]

  gateway:
    build: ./services/gateway
    environment:
      - NODE_ENV=development
    env_file: [ .env ]
    ports: [ "${GATEWAY_PORT:-8787}:8787" ]
    depends_on: [ chat ]

  chat:
    build: ./services/chat
    environment:
      - NODE_ENV=development
    env_file: [ .env ]
    depends_on: [ qdrant, ollama ]

  reranker:
    build: ./services/reranker
    env_file: [ .env ]
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
    depends_on: [ chat ]

  admin:
    build: ./services/admin
    environment:
      - NODE_ENV=development
      - VITE_GATEWAY_URL=http://gateway:8787
    ports:
      - "3030:3030"
    depends_on: [ gateway ]

volumes:
  qdrant_data:
  ollama:
